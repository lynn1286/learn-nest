ä¹‹å‰æˆ‘ä»¬å­¦ä¹ å¹¶äº†è§£äº†`typescript`çš„è£…é¥°å™¨ä¸å…ƒæ•°æ®ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹ï¼Œçœ‹çœ‹ä¸¤è€…ç»“åˆä½¿ç”¨èƒ½å¤Ÿåšåˆ°ä»€ä¹ˆäº‹æƒ…ï¼š

```tsx
import 'reflect-metadata'

class Example {
  // æ–¹æ³•è£…é¥°å™¨, è™½ç„¶tsæœ‰ç±»å‹æ£€æŸ¥ï¼Œä½†æ˜¯æ— æ³•é¿å… any script çš„åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¥å‚åšæ ¡éªŒ
  @validate
  print(val: string) {
    console.log('ğŸš€ ~  : Example -> print -> val', val)
  }
}

function validate(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  // design:paramtypes çš„ä½¿ç”¨éœ€è¦åœ¨ tsconfig.json å¼€å¯
  // é€šè¿‡ reflect-metadata å¾—åˆ°æ‰€è£…é¥°æ–¹æ³•ä¸Šçš„æ‰€æœ‰å‚æ•°ç±»å‹
  const paramstypes = Reflect.getMetadata('design:paramtypes', target, propertyKey)
  const originFunc = descriptor.value
  // é€šè¿‡æè¿°ç¬¦ä¿®æ”¹æ‰€è£…é¥°æ–¹æ³•ï¼Œåœ¨è¿è¡ŒåŸå§‹æ–¹æ³•å‰å…ˆè°ƒç”¨_innervalidateæ¥åŠ¨æ€æ£€æŸ¥å…¥å‚ç±»å‹
  descriptor.value = function (...args: any[]) {
    _innervalidate(args, paramstypes)
    originFunc.apply(this, args)
  }

  function _innervalidate(args: any[], types: any[]) {
    // å…¥å‚ä¸æ‰€éœ€å‚æ•°é•¿åº¦ä¸ç›¸åŒï¼ŒæŠ¥é”™ï¼ï¼ˆä¸è€ƒè™‘å‚æ•°ç¼ºçœæƒ…å†µï¼‰
    if (args.length != types.length) {
      throw new Error('Error: Wrong params length')
    }
    // ä¾æ¬¡æ¯”å¯¹å…¥å‚ä¸æ‰€éœ€å‚æ•°çš„ç±»å‹å¹¶åˆ¤æ–­å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼ˆè¿™é‡Œåªæ ¡éªŒäº†åŸºæœ¬ç±»å‹ï¼‰
    args.forEach((arg, index) => {
      const type = types[index].name.toLowerCase()
      if (typeof arg != type) {
        throw new Error(`Error: Need a ${type}, but get the ${typeof arg} ${arg} instead!`)
      }
    })
  }
}

const example = new Example()
// val1ç¬¦åˆé¢„æœŸï¼Œä½†val2åœ¨è¿™é‡Œéª—è¿‡äº†TSç¼–è¯‘å™¨
const val1: any = 'test'
const val2: any = 23
// å°è¯•è¿è¡Œ
try {
  // é€šè¿‡æ ¡éªŒï¼Œæ‰“å° 'test'
  example.print(val1)
  // æŠ¥é”™ï¼'Error: Need a string, but get the number 23 instead!'
  // æ²¡æœ‰éª—è¿‡æˆ‘ä»¬çš„validateè£…é¥°å™¨,å› ä¸ºæˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€è·å–äº†å®ƒçš„ç±»å‹ï¼
  example.print(val2)
} catch (e: any) {
  console.log(e.message)
}

```



é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿå®ç°ä¸€ä¸ªç®€å•çš„ `nest` ç¨‹åºï¼Œå…ˆæ¥çœ‹çœ‹ `nest` ä»£ç ç¤ºä¾‹ï¼š

```tsx
// éœ€è¦å®‰è£… @nestjs/core ã€ @nestjs/common ã€ reflect-metadata ã€ @nestjs/platform-express

import 'reflect-metadata'
import { NestFactory } from '@nestjs/core'
import { Module, Controller, Get, Injectable } from '@nestjs/common'

// Service
@Injectable()
export class CatsService {
  private readonly cats: string[] = ['ss', 'xx']

  hello(): string {
    return this.cats.join(',') + ' meow'
  }
}

// Controller
@Controller('/cats')
class CatsController {
  constructor(private catsService: CatsService) {}

  @Get('/hello')
  hello() {
    return this.catsService.hello()
  }
}

// Module
@Module({
  controllers: [CatsController],
  providers: [CatsService]
})
export class CatsModule {}

// Start
async function bootstrap() {
  const app = await NestFactory.create(CatsModule)
  await app.listen(3000)
}
bootstrap()
```

æœåŠ¡è·‘èµ·æ¥åï¼Œè®¿é—®ä¸‹ `/cats/hello` ï¼Œä¸å‡ºæ„å¤–ï¼ŒæœåŠ¡åº”è¯¥æ˜¯å¯åŠ¨å¹¶å“åº”äº†ss,xx meowã€‚

è®©æˆ‘ä»¬æ¥ä¸€ä¸€åˆ†æä¸€ä¸‹æˆ‘ä»¬éƒ½ç”¨åˆ°äº†Nest.jsæ‰€æä¾›çš„ä»€ä¹ˆåŠŸèƒ½ï¼š

- Service ï¼š `@Injectable`ç±»è£…é¥°å™¨ï¼Œæ ‡æ˜`CatsService`ç±»æ˜¯ä¸€ä¸ª`Provider`ï¼Œä»¥ä¾¿å…¶åç»­è¢«æ³¨å…¥;
- Controller: `@Controller`ç±»è£…é¥°å™¨ï¼Œæ ‡æ˜`CatsController`ç±»æ˜¯ä¸€ä¸ª`Controller`å¹¶ä¸”æ ¹è·¯å¾„è®¾ç½®ä¸º`/cats`ï¼›`@Get`æ˜¯æ–¹æ³•è£…é¥°å™¨ï¼Œæ ‡æ˜`hello`æ–¹æ³•æä¾›ä¸€ä¸ª`Get`æ¥å£ï¼Œç›¸å¯¹è·¯å¾„ä¸º`/hello`ï¼›
- Module:  `@Module`ç±»è£…é¥°å™¨ï¼Œæ¥æ”¶å¹¶å°†ä¸Šè¿°`Controller`å’Œ`Privider`è¿æ¥èµ·æ¥ï¼Œæ ‡æ˜`CatsModule`ç±»æ˜¯ä¸€ä¸ª`Module`ï¼›

- Start:  è°ƒç”¨`NestFactory.create`æ–¹æ³•ï¼Œæ¥æ”¶`CatsModule`æ„é€ ä¸€ä¸ªé¡¹ç›®å®ä¾‹ï¼Œä¹‹åå¯åŠ¨é¡¹ç›®å¹¶ç›‘å¬3000ç«¯å£ã€‚



çœ‹å®Œä¸Šè¿°ä»£ç ï¼Œäº§ç”Ÿäº†3ä¸ªç–‘é—®ï¼š

1. `CatsController` ä¸ºä»€ä¹ˆä¸ºä»€ä¹ˆèƒ½å¤Ÿæ‹¿åˆ° `catsService` çš„å®ä¾‹ï¼Ÿ
2. `create` åä¸ºä»€ä¹ˆå°±èƒ½å¤Ÿå¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Ÿ
3. `CatsModule` æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿ



ä¸‹é¢å¸¦ç€è¿™ä¸ª3ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬æ¥åˆ†åˆ«å®ç°ï¼Œå¹¶æœ€ç»ˆåˆ¨æå‡ºé—®é¢˜çš„å…³é”®ä»¥åŠåŸç†ã€‚



#### Injectable

```tsx
import { FAKE_INJECTABLE_WATERMARK } from './common/const'

/**
 * @description: ç»™è¿™ä¸ªç±»æ‰“ä¸Šä¸€ä¸ªprovideæ ‡è®°
 * @return {*}
 */
function Injectable() {
  // è¿”å›ç±»è£…é¥°å™¨
  return (target: any) => {
    Reflect.defineMetadata(FAKE_INJECTABLE_WATERMARK, true, target)
  }
}

export default Injectable

```

`Injectable`æ˜¯ä¸€ä¸ªè£…é¥°å™¨å·¥å‚ï¼Œåœ¨æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ª**ç±»è£…é¥°å™¨**ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†å…¶æ‰€è£…é¥°çš„ç±»æ ‡è®°ä¸ºå¯æ³¨å…¥çš„ï¼å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œè°ƒç”¨äº†`Reflect.defineMetadata`æ–¹æ³•å°†`key`è®¾ç½®æˆ`FAKE_INJECTABLE_WATERMARK`ï¼Œ`value`ä¸º`true`çš„å…ƒæ•°æ®æ·»åŠ åˆ°äº†å…¶æ‰€è£…é¥°çš„ç±»`target`ä¹‹ä¸Šï¼Œè¿™å°±æ˜¯`Nest.js`å¯¹`Provider`çš„æ ‡è®°æ–¹å¼ã€‚

åœ¨æˆ‘ä»¬çš„è¿·ä½ é¡¹ç›®ä¸­ï¼Œè¯¥ç±»è£…é¥°å™¨è£…é¥°äº†`CatsService`ç±»ï¼Œè¯¥ç±»å°†åœ¨æœªæ¥è¢«æ³¨å…¥`CatsController`ä¹‹ä¸­ã€‚



#### Controller

```tsx
import { FAKE_BASE_PATH } from './common/const'

/**
 * @description: Controller è£…é¥°å™¨,å°†pathå…ƒæ•°æ®æ·»åŠ åˆ°äº†å…¶æ‰€è£…é¥°çš„ç±»targetä¹‹ä¸Š
 * @param {string} path
 * @return {*}
 */
function Controller(path: string) {
  // è¿”å›ç±»è£…é¥°å™¨
  return function (target: any) {
    Reflect.defineMetadata(FAKE_BASE_PATH, path, target)
  }
}

export default Controller

```

`Contoller`æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²`path`ä½œä¸ºå…¶æ‰€è£…é¥°ç±»ä¸­ç›¸å…³`Http`ç›‘å¬æ–¹æ³•çš„æ ¹è·¯å¾„ï¼ˆè¢«`Get/Post`ç­‰ä¿®é¥°çš„æ–¹æ³•ï¼‰ï¼Œåœ¨æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ª**ç±»è£…é¥°å™¨**ã€‚è¿™é‡Œè°ƒç”¨äº†`Reflect.defineMetadata`æ–¹æ³•å°†`key`ä¸º`FAKE_BASE_PATH`ï¼Œ`value`ä¸º`path`çš„å…ƒæ•°æ®æ·»åŠ åˆ°äº†å…¶æ‰€è£…é¥°çš„ç±»targetä¹‹ä¸Šã€‚

åœ¨æˆ‘ä»¬çš„è¿·ä½ é¡¹ç›®ä¸­ï¼Œè¯¥ç±»è£…é¥°å™¨è£…é¥°äº†`CatsController`ç±»ï¼Œè¯¥ç±»çš„è·Ÿè·¯å¾„ä¸º`/cats`ã€‚



#### Get

```tsx
import { FAKE_PATH, FAKE_METHOD } from './common/const'

// Get/Post/Put/Delete/Patch/Options/Headç­‰Httpç›‘å¬æ–¹æ³•é€šç”¨
function Request(method: string) {
  return function (path: string) {
    // è¿”å›æ–¹æ³•è£…é¥°å™¨
    return function (target: any, propertyKey: string) {
      Reflect.defineMetadata(FAKE_METHOD, method, target, propertyKey)
      Reflect.defineMetadata(FAKE_PATH, path, target, propertyKey)
    }
  }
}

export const Get = Request('Get')
export const Post = Request('Post')

```

`Get`ä¸`Post/Put/Delete/Patch/Options/Head`ç­‰éƒ½æ˜¯ç”±`Request`è¿™ä¸ªé«˜é˜¶å‡½æ•°æ‰§è¡Œåè¿”å›çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²`path`ä½œä¸ºå…¶æ‰€è£…é¥°æ–¹æ³•ä¸­ç›¸å…³`Http`ç›‘å¬æ‰€ç›‘å¬çš„ç›¸å¯¹è·¯å¾„ï¼Œåœ¨æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ªæ–¹æ³•è£…é¥°å™¨ã€‚è¿™é‡Œè°ƒç”¨äº†`Reflect.defineMetadata`æ–¹æ³•å°†`key`ä¸º`FAKE_METHOD`ï¼Œ`value`ä¸º`method`çš„å…ƒæ•°æ®ä»¥åŠ`key`ä¸º`FAKE_PATH`ï¼Œ`value`ä¸º`path`çš„å…ƒæ•°æ®æ·»åŠ åˆ°äº†å…¶æ‰€è£…é¥°çš„æ–¹æ³•ä¹‹ä¸Šã€‚

åœ¨æˆ‘ä»¬çš„è¿·ä½ é¡¹ç›®ä¸­ï¼Œè¯¥æ–¹æ³•è£…é¥°å™¨è£…é¥°äº†`CatsController`ç±»ä¸‹çš„`hello`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ç›¸å¯¹è·¯å¾„ä¸º`/hello`ã€‚



#### Module

```tsx
/**
 * @description: Moduleæ¥å—ä¸€ä¸ªå¯¹è±¡metadataï¼ˆå…¶ä¸­å­˜å‚¨äº†ç›¸å…³ProvideråŠControllerï¼‰ä½œä¸ºæ³¨å†Œä¿¡æ¯
 * @param {Record} metadata
 * @param {*} any
 * @return {*}
 */
function Module(metadata: Record<string, any>) {
  return (target: any) => {
    for (const property in metadata) {
      Reflect.defineMetadata(property, metadata[property], target)
    }
  }
}

export default Module

```

`Module`æ¥å—ä¸€ä¸ªå¯¹è±¡`metadata`ï¼ˆå…¶ä¸­å­˜å‚¨äº†ç›¸å…³`Provider`åŠ`Controller`ï¼‰ä½œä¸ºæ³¨å†Œä¿¡æ¯ï¼Œåœ¨æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ª**ç±»è£…é¥°å™¨**ã€‚è¿™é‡Œéå†äº†`metadata`ï¼Œè°ƒç”¨`Reflect.defineMetadata`æ–¹æ³•å°†`key`è®¾ç½®ä¸º`metadataå¯¹è±¡çš„key`ï¼Œ`value`è®¾ç½®ä¸º`metadataå¯¹è±¡çš„å€¼` çš„å…ƒæ•°æ®ä¾æ¬¡æ·»åŠ åˆ°äº†å…¶æ‰€è£…é¥°çš„ç±»`target`ä¹‹ä¸Šã€‚

åœ¨æˆ‘ä»¬çš„è¿·ä½ é¡¹ç›®ä¸­ï¼Œè¯¥ç±»è£…é¥°å™¨è£…é¥°äº†`CatsModule`ç±»ã€‚



åˆ°äº†è¿™é‡Œï¼Œä¸‰ä¸ªé—®é¢˜å¥½åƒéƒ½æ²¡æœ‰å¾—åˆ°ç­”æ¡ˆï¼Œåˆ«æ€¥ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚



#### å¯åŠ¨ç±»

å¯ä»¥çœ‹åˆ°åœ¨å‰è¿°çš„æ‰€æœ‰è£…é¥°å™¨ä¸­ï¼Œæˆ‘ä»¬æ‰€åšçš„äº‹æƒ…æ€»ç»“èµ·æ¥åªæœ‰ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯æ·»åŠ å…ƒæ•°æ®ï¼æ—¢ç„¶æ˜¯æ·»åŠ ï¼Œé‚£è‚¯å®šå°±æœ‰ä½¿ç”¨çš„åœ°æ–¹ï¼Œæ²¡é”™ï¼Œå°±æ˜¯åœ¨å¯åŠ¨ç±»ä¸­ä½¿ç”¨ã€‚

```tsx
import { FAKE_BASE_PATH, FAKE_METHOD, FAKE_PATH, FAKE_INJECTABLE_WATERMARK } from './common/const'
import express from 'express'
import { Express } from 'express'

class MiniFactory {
  private app: Express
  private types: Record<string, any>

  constructor() {
    // å®ä¾‹åŒ–Express , nest é»˜è®¤ä¹Ÿæ˜¯ express ï¼Œ ä½†æ˜¯å®ƒçš„å®ç°æ˜¯å¯ä»¥è¿›è¡Œæ›¿æ¢çš„ï¼Œè¿™é‡Œç›´æ¥å°±å†™æ­»å•¦
    this.app = express()
    // typeså°†ç¼“å­˜æ‰€æœ‰Providerï¼Œä¿è¯å…¶åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡
    this.types = {}
  }

  // è°ƒç”¨è¯¥æ–¹æ³•ä»¥æ³¨å†Œæ‰€éœ€ä¿¡æ¯è‡³Expresså®ä¾‹å¹¶è¿”å›
  create(module: any): Express {
    // è¿˜è®°å¾—åœ¨modulesè®¾ç½®çš„å…ƒæ•°æ®å§ - è¿™é‡Œå°±æ˜¯è·å–Moduleä¸­æ³¨å†Œçš„Controllers
    const Controllers = Reflect.getMetadata('controllers', module)
    this.initControllers(Controllers)
    // è¿”å›Expresså®ä¾‹
    return this.app
  }

  // åˆå§‹åŒ–æ‰€æœ‰Controllers - Controller[]
  initControllers(Controllers: any) {
    Controllers.forEach((Controller: any) => {
      // design:paramtypes è¿™ä¸ªkeyæ˜¯é€šè¿‡é…ç½® tsconfig.json çš„ emitDecoratorMetadata å±æ€§åæ‰æœ‰çš„ï¼Œç›®çš„æ˜¯è·å–constructoræ‰€éœ€providerï¼ˆæ³¨å…¥çš„ä¾èµ–é¡¹ï¼‰
      const paramtypes = Reflect.getMetadata('design:paramtypes', Controller)

      const args = paramtypes.map((Type: any) => {
        // è¿˜è®°å¾—åœ¨Injectableè£…é¥°å™¨è®¾ç½®çš„å…ƒæ•°æ®å§ - è¿™é‡Œå°±æ˜¯è·å–è¿™ä¸ªæ ‡è®°ï¼Œå¦‚æœæ²¡æœ‰æ ‡è®°åˆ™æŠ¥é”™
        if (!Reflect.getMetadata(FAKE_INJECTABLE_WATERMARK, Type)) {
          throw new Error(`${Type.name} is not injectable!`)
        }

        // é‡ç‚¹æ¥å•¦ï¼Œ å°† Controller ä¸­çš„ä¾èµ–å®ä¾‹åŒ–
        return this.types[Type.name] ? this.types[Type.name] : (this.types[Type.name] = new Type())
      })

      //å› ä¸ºå‰ä¸€æ­¥å·²ç»å°†ä¾èµ–å®ä¾‹åŒ–ï¼Œç°åœ¨é€šè¿‡æ„é€ å™¨æ³¨å…¥ä¾èµ–çš„æ–¹å¼ï¼Œå°†ä¾èµ–æ³¨å…¥ Controller ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ‰‹åŠ¨newä¹Ÿèƒ½å¤Ÿä½¿ç”¨ä¾èµ–å•¦
      const controller = new Controller(...args)

      // è¿˜è®°å¾—Controllerè£…é¥°å™¨è®¾ç½®çš„å…ƒæ•°æ®å§ - è¿™é‡Œå°±æ˜¯è·å–è¯¥Controllerè®¾ç½®çš„path
      const basePath = Reflect.getMetadata(FAKE_BASE_PATH, Controller)
      // è·å–åˆ°æ ¹è·¯å¾„ï¼Œå½“ç„¶æ˜¯è¦åˆå§‹åŒ–è·¯ç”±å•¦
      this.initRoute(controller, basePath)
    })
  }

  // åˆå§‹åŒ–ä¸€ä¸ªcontrollerå®ä¾‹ä¸Šæ‰€æœ‰çš„ç›‘å¬æ–¹æ³•
  initRoute(controller: any, basePath: string) {
    // æ³¨æ„å“¦ï¼ŒReflect.getPrototypeOfä¸æ˜¯ reflect-metadata åŒ…çš„æ–¹æ³•ï¼Œ æ˜¯JavaScript æ ‡å‡†å†…ç½®å¯¹è±¡ï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–Controllerä¸Šçš„æ‰€æœ‰æ–¹æ³•å
    const proto: any = Reflect.getPrototypeOf(controller)

    // æ§åˆ¶å™¨ä¸­æ²¡æœ‰æ–¹æ³•ï¼Œå°±ä¸éœ€è¦æ³¨å†Œè·¯ç”±å•¦
    if (!proto) return

    // Object.getOwnPropertyNames() é™æ€æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶åŒ…å«ç»™å®šå¯¹è±¡ä¸­æ‰€æœ‰è‡ªæœ‰å±æ€§ï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼Œä½†ä¸åŒ…æ‹¬ä½¿ç”¨ symbol å€¼ä½œä¸ºåç§°çš„å±æ€§ï¼‰ã€‚ç›®çš„æ˜¯è¿‡æ»¤æ‰æ„é€ å‡½æ•°ç­‰å…¶ä»–å±æ€§,æ‹¿åˆ°æ§åˆ¶å™¨çš„çœŸæ­£æ–¹æ³•
    const methodsNames = Object.getOwnPropertyNames(proto).filter(
      item => item !== 'constructor' && typeof proto[item] === 'function'
    )

    // æ‹¿åˆ°æ–¹æ³•å•¦ï¼ä¸‹ä¸€æ­¥è‚¯å®šæ˜¯è¿›è¡Œè·¯ç”±æ³¨å†Œ
    methodsNames.forEach(methodName => {
      const fn = proto[methodName]
      //è¿˜è®°å¾— Get è£…é¥°å™¨è®¾ç½®çš„å…ƒæ•°æ®å§ï¼Œè¿™é‡Œå°±æ˜¯è·å–è¯¥è®¾ç½®çš„path
      const method = Reflect.getMetadata(FAKE_METHOD, controller, methodName)

      // è¿™ä¸ªæ˜¯Controllerè£…é¥°å™¨è®¾ç½®çš„å…ƒæ•°æ®ï¼Œæ˜¯æ ¹è·¯å¾„å“¦ï¼Œåˆ«å¿˜äº†å–å‡ºæ¥
      const path = Reflect.getMetadata(FAKE_PATH, controller, methodName)

      // å¿½ç•¥æœªè£…é¥°æ–¹æ³•
      if (!method || !path) return

      // æ„é€ å¹¶æ³¨å†Œè·¯ç”±
      const route = {
        path: basePath + path, // æ ¹è·¯å¾„æ‹¼æ¥
        method: method.toLowerCase(), // æ–¹æ³•å ï¼Œ ä¾‹å¦‚ get postç­‰
        fn: fn.bind(controller)
      }
      this.registerRoute(route)
    })
  }

  // å°†Httpç›‘å¬æ–¹æ³•æ³¨å†Œè‡³Expresså®ä¾‹ä¹‹ä¸­
  registerRoute(route: { path: string; method: string; fn: Function }) {
    const { path, method, fn } = route
    // è¿˜è®°å¾— express çš„è·¯ç”±æ³¨å†Œæ–¹å¼å§
    // @ts-ignore
    this.app[method](path, (req: any, res: any) => {
      res.send(fn(req))
    })
  }
}

export default new MiniFactory()

```

ä»¥ä¸Šä»£ç ä¸ºæˆ‘ä»¬è§£ç­”äº†ä¹‹å‰çš„ä¸‰ä¸ªç–‘é—®ï¼š

1. `CatsController` ä¸ºä»€ä¹ˆä¸ºä»€ä¹ˆèƒ½å¤Ÿæ‹¿åˆ° `catsService` çš„å®ä¾‹ï¼Ÿ

è¿™æ˜¯å› ä¸ºï¼Œåœ¨è°ƒç”¨ create æ–¹æ³•çš„æ—¶å€™ï¼Œå†…éƒ¨é€šè¿‡å…ƒæ•°æ®æ‹¿åˆ°äº†ä¾èµ–ï¼Œå¹¶ä¸”è¿›è¡Œäº†å®ä¾‹åŒ–åé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥çš„æ–¹å¼æ³¨å…¥åˆ°æ§åˆ¶å™¨å†…éƒ¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚

2. `create` åä¸ºä»€ä¹ˆå°±èƒ½å¤Ÿå¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Ÿ

å¯åŠ¨ç±»å†…éƒ¨å®šä¹‰äº†`express`ä½œä¸º`http`æœåŠ¡å™¨ï¼Œè¿›è¡Œäº†ä¸€ç³»åˆ—çš„è·¯ç”±æ³¨å†Œç­‰ã€‚

3. `CatsModule` æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿ

æ•´ä¸ªæ¨¡å—çš„å…¥å£ï¼Œç”¨æ¥ç®¡ç†controllerå’Œprovideçš„ã€‚
